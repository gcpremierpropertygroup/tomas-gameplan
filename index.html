<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#06060f">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=Space+Mono:wght@700&display=swap" rel="stylesheet">
<title>Tomas Chaves ‚Äî Game Plan</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#06060f;--surface:rgba(255,255,255,.03);--surface2:rgba(255,255,255,.055);--surface3:rgba(255,255,255,.09);
  --neon:#00e5ff;--neon-glow:rgba(0,229,255,.18);--neon-soft:rgba(0,229,255,.08);
  --fire:#ff4757;--fire-glow:rgba(255,71,87,.15);
  --gold:#ffc312;--gold-glow:rgba(255,195,18,.12);
  --mint:#0be881;--mint-glow:rgba(11,232,129,.15);
  --purple:#a855f7;--purple-glow:rgba(168,85,247,.12);
  --text:#eef0ff;--text2:#7a7da8;--text3:#484b6a;
  --border:rgba(255,255,255,.06);
  --glass:rgba(15,15,30,.65);--glass-border:rgba(255,255,255,.08);
  --radius:18px;
}
html{height:100%}
body{
  font-family:'Outfit',system-ui,sans-serif;
  background:var(--bg);color:var(--text);
  min-height:100%;padding:0 0 88px 0;overflow-x:hidden;
}
::selection{background:var(--neon);color:#000}
input,textarea,select,button{font-family:inherit}

/* ===== ANIMATED BACKGROUND ===== */
.bg-layer{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.bg-orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.4;animation:orbFloat 20s ease-in-out infinite}
.bg-orb.o1{width:340px;height:340px;background:rgba(0,229,255,.12);top:-10%;left:-5%;animation-delay:0s}
.bg-orb.o2{width:280px;height:280px;background:rgba(168,85,247,.1);bottom:-5%;right:-5%;animation-delay:-7s}
.bg-orb.o3{width:200px;height:200px;background:rgba(255,71,87,.06);top:40%;right:10%;animation-delay:-14s}
@keyframes orbFloat{0%,100%{transform:translate(0,0) scale(1)}25%{transform:translate(30px,-20px) scale(1.1)}50%{transform:translate(-20px,30px) scale(.9)}75%{transform:translate(20px,20px) scale(1.05)}}
.bg-grid{position:absolute;inset:0;
  background-image:linear-gradient(rgba(255,255,255,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.015) 1px,transparent 1px);
  background-size:48px 48px;
  mask-image:radial-gradient(ellipse at 50% 30%,black 0%,transparent 70%);-webkit-mask-image:radial-gradient(ellipse at 50% 30%,black 0%,transparent 70%);
}

/* ===== HEADER ===== */
.header{padding:52px 20px 14px;position:relative;z-index:1}
.header-top{display:flex;align-items:center;gap:14px}
.avatar{
  width:56px;height:56px;border-radius:16px;
  background:linear-gradient(135deg,var(--neon),var(--purple));
  display:flex;align-items:center;justify-content:center;
  font-size:24px;font-weight:900;color:#000;
  position:relative;flex-shrink:0;
}
.avatar::before{
  content:'';position:absolute;inset:-3px;border-radius:19px;
  background:conic-gradient(from 0deg,var(--neon),var(--purple),var(--fire),var(--neon));
  animation:avatarSpin 4s linear infinite;opacity:.6;z-index:-1;
}
.avatar::after{
  content:'';position:absolute;inset:-8px;border-radius:24px;
  background:conic-gradient(from 0deg,var(--neon),var(--purple),var(--fire),var(--neon));
  animation:avatarSpin 4s linear infinite;opacity:.15;filter:blur(12px);z-index:-2;
}
@keyframes avatarSpin{to{transform:rotate(360deg)}}
.header h1{font-size:28px;font-weight:900;letter-spacing:-.5px;color:#fff;line-height:1.1;
  background:linear-gradient(135deg,#fff 60%,var(--neon));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.header .sub{font-size:12px;font-weight:600;color:var(--text2);margin-top:2px;-webkit-text-fill-color:var(--text2)}
.header-meta{display:flex;align-items:center;gap:8px;margin-top:14px;flex-wrap:wrap}
.day-badge{
  display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;
  font-size:11px;font-weight:800;letter-spacing:.5px;text-transform:uppercase;
  backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
}
.day-badge.heavy{background:rgba(255,71,87,.12);color:var(--fire);border:1px solid rgba(255,71,87,.2)}
.day-badge.light{background:rgba(11,232,129,.1);color:var(--mint);border:1px solid rgba(11,232,129,.2)}
.day-badge .pulse{width:7px;height:7px;border-radius:50%;animation:pulse 1.8s ease infinite}
.heavy .pulse{background:var(--fire)}
.light .pulse{background:var(--mint)}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.7)}}

.level-badge{
  display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;
  background:linear-gradient(135deg,rgba(255,195,18,.12),rgba(255,195,18,.06));
  border:1px solid rgba(255,195,18,.2);
  font-family:'Space Mono',monospace;font-size:10px;font-weight:700;color:var(--gold);letter-spacing:.5px;
  backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
}
.streak-wrap{
  display:inline-flex;align-items:center;gap:5px;padding:5px 14px;border-radius:20px;
  background:rgba(255,71,87,.1);border:1px solid rgba(255,71,87,.15);
  backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
}
.streak-num{font-family:'Space Mono',monospace;font-size:12px;font-weight:700;color:var(--fire)}
.streak-label{font-size:10px;color:rgba(255,71,87,.7);font-weight:600}
.streak-fire{font-size:14px;filter:saturate(1.5)}

/* ===== XP BAR ===== */
.xp-bar-wrap{margin-top:16px;position:relative}
.xp-bar-bg{height:10px;background:rgba(255,255,255,.04);border-radius:5px;overflow:hidden;
  box-shadow:inset 0 1px 3px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.03)}
.xp-bar-fill{height:100%;border-radius:5px;transition:width .6s cubic-bezier(.4,0,.2,1);
  background:linear-gradient(90deg,var(--neon),var(--purple));position:relative;
  box-shadow:0 0 12px rgba(0,229,255,.3)}
.xp-bar-fill::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,transparent 40%,rgba(255,255,255,.4) 60%,transparent 80%);
  animation:xpShine 2s ease-in-out infinite;
}
@keyframes xpShine{0%{transform:translateX(-150%)}100%{transform:translateX(250%)}}
.xp-labels{display:flex;justify-content:space-between;margin-top:6px}
.xp-labels span{font-family:'Space Mono',monospace;font-size:10px;font-weight:700;color:var(--text3)}
.xp-labels .xp-val{color:var(--neon);text-shadow:0 0 8px rgba(0,229,255,.3)}

/* ===== TABS ===== */
.tabs{display:flex;gap:4px;padding:8px 20px 16px;position:relative;z-index:1;overflow-x:auto;-webkit-overflow-scrolling:touch}
.tabs::-webkit-scrollbar{display:none}
.tab{
  padding:10px 20px;font-size:13px;font-weight:700;color:var(--text3);cursor:pointer;
  border-radius:14px;background:transparent;border:1px solid transparent;white-space:nowrap;
  transition:all .3s cubic-bezier(.4,0,.2,1);flex-shrink:0;
}
.tab.active{
  color:var(--neon);
  background:linear-gradient(135deg,rgba(0,229,255,.1),rgba(168,85,247,.06));
  border-color:rgba(0,229,255,.2);
  box-shadow:0 0 20px rgba(0,229,255,.08);
}
.tab:active{transform:scale(.94)}

/* ===== PAGES ===== */
.page{display:none;padding:0 20px 24px;position:relative;z-index:1}
.page.active{display:block;animation:fadeUp .4s cubic-bezier(.4,0,.2,1)}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}

/* ===== GLASS CARDS ===== */
.card{
  background:var(--glass);border-radius:var(--radius);padding:22px;margin-bottom:16px;
  border:1px solid var(--glass-border);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  box-shadow:0 4px 24px rgba(0,0,0,.2),inset 0 1px 0 rgba(255,255,255,.04);
  transition:border-color .3s,box-shadow .3s;
}
.card:hover{border-color:rgba(255,255,255,.1);box-shadow:0 8px 32px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.06)}
.card-label{
  font-size:11px;font-weight:800;letter-spacing:1.8px;text-transform:uppercase;
  color:var(--text3);margin-bottom:18px;display:flex;align-items:center;gap:10px;
}
.card-label .badge{font-family:'Space Mono',monospace;font-size:10px;font-weight:700;padding:4px 12px;border-radius:10px}
.badge-neon{background:var(--neon-soft);color:var(--neon);border:1px solid rgba(0,229,255,.12)}
.badge-fire{background:var(--fire-glow);color:var(--fire);border:1px solid rgba(255,71,87,.12)}
.badge-gold{background:var(--gold-glow);color:var(--gold);border:1px solid rgba(255,195,18,.12)}

/* ===== BIG 3 ===== */
.big3-item{display:flex;align-items:center;gap:14px;padding:16px 0}
.big3-item+.big3-item{border-top:1px solid var(--border)}
.big3-rank{
  width:42px;height:42px;border-radius:13px;display:flex;align-items:center;justify-content:center;
  font-family:'Space Mono',monospace;font-weight:700;font-size:17px;flex-shrink:0;position:relative;overflow:hidden;
}
.big3-rank::before{content:'';position:absolute;inset:0;opacity:.15;border-radius:13px}
.big3-rank.r1{color:var(--fire)}.big3-rank.r1::before{background:var(--fire)}
.big3-rank.r2{color:var(--gold)}.big3-rank.r2::before{background:var(--gold)}
.big3-rank.r3{color:var(--neon)}.big3-rank.r3::before{background:var(--neon)}
.big3-input{
  flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:13px;
  padding:14px 16px;color:var(--text);font-size:15px;font-weight:500;outline:none;transition:all .3s;
}
.big3-input:focus{border-color:rgba(0,229,255,.4);box-shadow:0 0 0 3px rgba(0,229,255,.08),0 0 20px rgba(0,229,255,.06)}
.big3-input::placeholder{color:var(--text3);font-weight:400;font-size:14px}
.check-btn{
  width:40px;height:40px;border-radius:50%;border:2px solid rgba(255,255,255,.1);background:none;
  cursor:pointer;flex-shrink:0;transition:all .3s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center;position:relative;
}
.check-btn:active{transform:scale(.8)}
.check-btn.checked{
  border-color:var(--mint);background:var(--mint);
  box-shadow:0 0 24px rgba(11,232,129,.35);animation:checkPop .4s cubic-bezier(.175,.885,.32,1.275);
}
@keyframes checkPop{0%{transform:scale(.6)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
.check-btn.checked::after{content:'‚úì';color:#000;font-size:18px;font-weight:900}

/* ===== TIMELINE ===== */
.tl-item{display:flex;gap:14px;padding:14px 0;align-items:flex-start}
.tl-item+.tl-item{border-top:1px solid var(--border)}
.tl-time{
  font-family:'Space Mono',monospace;font-size:11px;font-weight:700;
  color:var(--neon);min-width:108px;padding-top:3px;flex-shrink:0;letter-spacing:.3px;
  text-shadow:0 0 8px rgba(0,229,255,.2);
}
.tl-label{font-size:15px;font-weight:700;color:var(--text)}
.tl-desc{font-size:12px;color:var(--text3);margin-top:4px;line-height:1.5;font-weight:500}

/* ===== HW TRACKER STYLES ===== */
.hw-stats{display:flex;gap:8px;margin-bottom:18px}
.hw-stat{
  flex:1;text-align:center;padding:14px 8px;border-radius:16px;
  background:var(--glass);border:1px solid var(--glass-border);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  box-shadow:0 2px 12px rgba(0,0,0,.15);
}
.hw-stat-num{font-family:'Space Mono',monospace;font-size:28px;font-weight:700;line-height:1}
.hw-stat-label{font-size:10px;font-weight:700;color:var(--text3);margin-top:6px;text-transform:uppercase;letter-spacing:.5px}
.hw-stat.overdue .hw-stat-num{color:var(--fire);text-shadow:0 0 16px rgba(255,71,87,.3)}
.hw-stat.pending .hw-stat-num{color:var(--gold);text-shadow:0 0 16px rgba(255,195,18,.3)}
.hw-stat.done .hw-stat-num{color:var(--mint);text-shadow:0 0 16px rgba(11,232,129,.3)}

.hw-add-form{background:var(--glass);border-radius:16px;padding:18px;margin-bottom:18px;border:1px solid var(--glass-border);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);box-shadow:0 4px 24px rgba(0,0,0,.2)}
.hw-add-form:focus-within{border-color:rgba(0,229,255,.2);box-shadow:0 4px 24px rgba(0,0,0,.2),0 0 0 3px rgba(0,229,255,.06)}
.hw-form-row{display:flex;gap:8px;margin-bottom:8px}
.hw-form-row:last-child{margin-bottom:0}
.hw-f-input{
  background:var(--surface2);border:1px solid var(--border);border-radius:12px;
  padding:12px;color:var(--text);font-size:14px;font-weight:500;outline:none;transition:all .3s;flex:1;min-width:0;
}
.hw-f-input:focus{border-color:rgba(0,229,255,.4);box-shadow:0 0 0 3px rgba(0,229,255,.06)}
.hw-f-input::placeholder{color:var(--text3)}
select.hw-f-input{
  appearance:none;-webkit-appearance:none;padding-right:28px;
  background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0l5 6 5-6' fill='%23484b6a'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 10px center;
}
.hw-f-date{flex:1;min-width:0;color-scheme:dark}
.hw-f-pri{max-width:70px;text-align:center;font-family:'Space Mono',monospace;font-weight:700}
.hw-add-submit{
  width:100%;padding:15px;border:none;border-radius:14px;
  background:linear-gradient(135deg,var(--neon),var(--purple));color:#000;
  font-size:13px;font-weight:800;cursor:pointer;letter-spacing:.5px;text-transform:uppercase;
  transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 4px 20px rgba(0,229,255,.2);position:relative;overflow:hidden;
}
.hw-add-submit::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,transparent 30%,rgba(255,255,255,.15) 50%,transparent 70%);
  transform:translateX(-100%);transition:transform .4s;
}
.hw-add-submit:hover::before{transform:translateX(100%)}
.hw-add-submit:active{transform:scale(.96);opacity:.9}
.hw-sync-btn{
  width:100%;padding:14px;border:none;border-radius:14px;
  background:linear-gradient(135deg,#00e676,#00bfa5);color:#000;
  font-size:13px;font-weight:800;cursor:pointer;letter-spacing:.5px;text-transform:uppercase;
  transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 4px 20px rgba(0,230,118,.2);position:relative;overflow:hidden;
  margin-top:12px;
}
.hw-sync-btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,transparent 30%,rgba(255,255,255,.15) 50%,transparent 70%);
  transform:translateX(-100%);transition:transform .4s;
}
.hw-sync-btn:hover::before{transform:translateX(100%)}
.hw-sync-btn:active{transform:scale(.96);opacity:.9}
.hw-sync-btn.syncing{animation:syncPulse 1s ease-in-out infinite}
@keyframes syncPulse{0%,100%{opacity:1}50%{opacity:.6}}
.b3-lock-btn{
  width:100%;padding:14px;border:none;border-radius:14px;
  background:linear-gradient(135deg,#7c4dff,#536dfe);color:#fff;
  font-size:13px;font-weight:800;cursor:pointer;letter-spacing:.5px;text-transform:uppercase;
  transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 4px 20px rgba(124,77,255,.25);position:relative;overflow:hidden;margin-top:14px;
}
.b3-lock-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 30%,rgba(255,255,255,.15) 50%,transparent 70%);transform:translateX(-100%);transition:transform .4s}
.b3-lock-btn:hover::before{transform:translateX(100%)}
.b3-lock-btn:active{transform:scale(.96);opacity:.9}
.b3-lock-btn.syncing{animation:syncPulse 1s ease-in-out infinite}
.b3-lock-btn.locked{background:linear-gradient(135deg,#00e676,#00bfa5);color:#000;box-shadow:0 4px 20px rgba(0,230,118,.25)}

.hw-filter-bar{display:flex;gap:6px;margin-bottom:14px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.hw-filter-bar::-webkit-scrollbar{display:none}
.hw-filter{
  padding:8px 16px;border-radius:12px;font-size:12px;font-weight:700;cursor:pointer;
  border:1px solid var(--border);background:none;color:var(--text3);white-space:nowrap;
  transition:all .25s;flex-shrink:0;
}
.hw-filter.active{
  color:var(--neon);background:rgba(0,229,255,.08);border-color:rgba(0,229,255,.2);
  box-shadow:0 0 12px rgba(0,229,255,.06);
}
.hw-filter .count{font-family:'Space Mono',monospace;font-size:10px;margin-left:4px;opacity:.7}

.hw-list-section{margin-bottom:12px}
.hw-section-label{
  font-size:10px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;
  padding:8px 0 10px;display:flex;align-items:center;gap:8px;
}
.hw-section-label.overdue{color:var(--fire)}
.hw-section-label.today{color:var(--gold)}
.hw-section-label.upcoming{color:var(--text2)}
.hw-section-label.completed{color:var(--mint)}
.hw-section-label .dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.hw-section-label.overdue .dot{background:var(--fire);box-shadow:0 0 8px var(--fire)}
.hw-section-label.today .dot{background:var(--gold);box-shadow:0 0 8px var(--gold)}
.hw-section-label.upcoming .dot{background:var(--text2)}
.hw-section-label.completed .dot{background:var(--mint);box-shadow:0 0 8px var(--mint)}

.hw-item{
  background:var(--glass);border-radius:16px;padding:14px 16px;margin-bottom:8px;
  border:1px solid var(--glass-border);transition:all .3s;
  backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
  box-shadow:0 2px 12px rgba(0,0,0,.15);
}
.hw-item.overdue{border-left:3px solid var(--fire)}
.hw-item.today{border-left:3px solid var(--gold)}
.hw-item.is-done{opacity:.45}
.hw-item-top{display:flex;align-items:center;gap:10px}
.hw-item-check{
  width:34px;height:34px;border-radius:50%;border:2px solid rgba(255,255,255,.12);background:none;
  cursor:pointer;flex-shrink:0;transition:all .3s;display:flex;align-items:center;justify-content:center;
}
.hw-item-check:active{transform:scale(.8)}
.hw-item-check.checked{border-color:var(--mint);background:var(--mint);box-shadow:0 0 20px rgba(11,232,129,.3)}
.hw-item-check.checked::after{content:'‚úì';color:#000;font-size:14px;font-weight:900}
.hw-item-check.in-prog{border-color:var(--gold);background:var(--gold-glow)}
.hw-item-check.in-prog::after{content:'‚óê';color:var(--gold);font-size:16px}
.hw-item-info{flex:1;min-width:0}
.hw-item-name{font-size:15px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hw-item.is-done .hw-item-name{text-decoration:line-through;color:var(--text3)}
.hw-item-meta{display:flex;align-items:center;gap:8px;margin-top:4px;flex-wrap:wrap}
.hw-tag{
  font-size:10px;font-weight:700;padding:3px 8px;border-radius:8px;letter-spacing:.3px;
  display:inline-flex;align-items:center;gap:4px;
}
.hw-tag-subject{background:var(--purple-glow);color:var(--purple);border:1px solid rgba(168,85,247,.15)}
.hw-tag-due{background:var(--surface3);color:var(--text2);border:1px solid var(--border)}
.hw-tag-due.overdue{background:var(--fire-glow);color:var(--fire);border-color:rgba(255,71,87,.2)}
.hw-tag-due.today{background:var(--gold-glow);color:var(--gold);border-color:rgba(255,195,18,.2)}
.hw-tag-due.tomorrow{background:var(--neon-soft);color:var(--neon);border-color:rgba(0,229,255,.15)}
.hw-tag-pri{font-family:'Space Mono',monospace}
.hw-tag-pri.p1{background:var(--fire-glow);color:var(--fire);border:1px solid rgba(255,71,87,.15)}
.hw-tag-pri.p2{background:var(--gold-glow);color:var(--gold);border:1px solid rgba(255,195,18,.15)}
.hw-tag-pri.p3{background:var(--surface3);color:var(--text3);border:1px solid var(--border)}
.hw-item-actions{display:flex;gap:6px;flex-shrink:0}
.hw-action-btn{
  width:34px;height:34px;border-radius:11px;border:none;background:var(--surface2);
  color:var(--text3);cursor:pointer;font-size:16px;
  display:flex;align-items:center;justify-content:center;transition:all .25s;
}
.hw-action-btn:active{transform:scale(.85)}
.hw-action-btn.cal{font-size:14px}
.hw-action-btn.cal:hover{color:var(--neon);background:var(--neon-soft);box-shadow:0 0 12px rgba(0,229,255,.1)}
.hw-action-btn.del:hover{color:var(--fire);background:var(--fire-glow)}

/* Cancel modal */
.cancel-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:600;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);align-items:flex-end;justify-content:center}
.cancel-overlay.open{display:flex}
.cancel-sheet{width:100%;max-width:480px;background:#0f0f1e;border:1px solid rgba(255,255,255,.08);border-radius:24px 24px 0 0;padding:20px 16px 36px;animation:slideUp .25s ease}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.cancel-sheet h3{font-size:14px;font-weight:800;color:var(--text);text-align:center;margin-bottom:4px}
.cancel-sheet .cancel-sub{font-size:12px;color:var(--text3);text-align:center;margin-bottom:18px}
.cancel-reason-btn{width:100%;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);border-radius:14px;padding:14px 16px;margin-bottom:8px;color:var(--text);font-family:inherit;font-size:14px;font-weight:500;text-align:left;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all .15s}
.cancel-reason-btn:active{transform:scale(.97);background:rgba(255,71,87,.1);border-color:rgba(255,71,87,.3)}
.cancel-reason-icon{font-size:20px;flex-shrink:0}
.cancel-dismiss{width:100%;background:none;border:none;color:var(--text3);font-family:inherit;font-size:13px;padding:14px;cursor:pointer;margin-top:4px}

.hw-empty{text-align:center;padding:48px 20px;color:var(--text3);font-size:14px;font-weight:500}
.hw-empty-icon{font-size:56px;margin-bottom:14px;display:block;opacity:.4}

/* ===== SCOREBOARD ===== */
.score-week{display:grid;gap:8px}
.score-day-row{display:grid;grid-template-columns:52px repeat(4,1fr) 44px;gap:6px;align-items:center;
  padding:4px 0;border-radius:12px;transition:background .2s}
.score-day-row:hover{background:rgba(255,255,255,.02)}
.score-day-row.today-row{background:rgba(0,229,255,.03);border:1px solid rgba(0,229,255,.06);padding:4px 8px;margin:0 -8px}
.score-cat-header{font-size:9px;font-weight:800;color:var(--text3);text-align:center;letter-spacing:.5px;text-transform:uppercase;padding:2px 0}
.score-day-label{font-size:13px;font-weight:700;color:var(--text2)}
.score-day-label.is-today{color:var(--neon);text-shadow:0 0 8px rgba(0,229,255,.2)}
.score-toggle{
  width:100%;aspect-ratio:1;max-width:44px;margin:0 auto;border-radius:13px;
  border:2px solid rgba(255,255,255,.06);background:var(--surface2);cursor:pointer;
  display:flex;align-items:center;justify-content:center;transition:all .3s cubic-bezier(.4,0,.2,1);font-size:16px;
}
.score-toggle:active{transform:scale(.8)}
.score-toggle.yes{border-color:var(--mint);background:rgba(11,232,129,.12);box-shadow:0 0 16px rgba(11,232,129,.15)}
.score-toggle.yes::after{content:'‚úì';color:var(--mint);font-weight:900;font-size:16px}

.total-bar{
  display:flex;align-items:center;justify-content:space-between;
  background:var(--glass);border-radius:18px;padding:22px;margin-top:18px;
  border:1px solid var(--glass-border);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  box-shadow:0 4px 24px rgba(0,0,0,.2);
}
.total-label{font-size:11px;font-weight:800;letter-spacing:1.5px;color:var(--text3);text-transform:uppercase}
.total-num{font-family:'Space Mono',monospace;font-size:40px;font-weight:700;line-height:1}
.total-num.good{color:var(--mint);text-shadow:0 0 28px rgba(11,232,129,.35)}
.total-num.mid{color:var(--gold);text-shadow:0 0 28px rgba(255,195,18,.25)}
.total-num.bad{color:var(--fire);text-shadow:0 0 28px rgba(255,71,87,.25)}
.total-num span{font-size:16px;color:var(--text3);font-weight:700}
.score-day-pts{font-family:'Space Mono',monospace;font-size:17px;font-weight:700;text-align:center}
.score-day-pts.high{color:var(--mint);text-shadow:0 0 8px rgba(11,232,129,.2)}
.score-day-pts.mid{color:var(--gold)}
.score-day-pts.low{color:var(--text3)}

.reward-track{
  margin-top:18px;padding:20px;background:var(--glass);border-radius:18px;
  border:1px solid var(--glass-border);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  box-shadow:0 4px 24px rgba(0,0,0,.2);
}
.reward-bar-bg{height:12px;background:rgba(255,255,255,.04);border-radius:6px;overflow:hidden;position:relative;
  box-shadow:inset 0 1px 3px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.03)}
.reward-bar-fill{height:100%;border-radius:6px;transition:width .6s cubic-bezier(.4,0,.2,1);position:relative}
.reward-bar-fill.low{background:linear-gradient(90deg,var(--fire),#ff6b3d)}
.reward-bar-fill.mid{background:linear-gradient(90deg,var(--fire),var(--gold))}
.reward-bar-fill.high{background:linear-gradient(90deg,var(--gold),var(--mint))}
.reward-bar-fill.max{background:linear-gradient(90deg,var(--mint),var(--neon))}
.reward-bar-fill::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,transparent 40%,rgba(255,255,255,.3) 60%,transparent 80%);
  animation:xpShine 2.5s ease-in-out infinite;
}
.reward-markers{display:flex;justify-content:space-between;margin-top:10px;position:relative}
.reward-marker{text-align:center}
.reward-marker .num{font-family:'Space Mono',monospace;font-size:10px;font-weight:700;color:var(--text3)}
.reward-marker .label{font-size:9px;font-weight:700;color:var(--text3);margin-top:2px;letter-spacing:.3px}
.reward-marker.active .num{color:var(--mint)}
.reward-marker.active .label{color:var(--mint)}
.reward-marker.danger .num{color:var(--fire)}
.reward-marker.danger .label{color:var(--fire)}
.reset-link{display:block;text-align:center;margin-top:16px;font-size:12px;color:var(--text3);cursor:pointer;transition:color .2s;font-weight:600}
.reset-link:hover{color:var(--fire)}

/* ===== CHECK-IN ===== */
.ci-q{margin-bottom:20px}
.ci-q label{display:block;font-size:14px;font-weight:700;color:var(--text);margin-bottom:8px}
.ci-q label span{color:var(--text3);font-weight:500;font-size:12px}
.ci-textarea{
  width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:14px;
  padding:16px;color:var(--text);font-size:14px;font-weight:500;line-height:1.6;
  min-height:88px;outline:none;resize:vertical;transition:all .3s;
}
.ci-textarea:focus{border-color:rgba(0,229,255,.4);box-shadow:0 0 0 3px rgba(0,229,255,.06),0 0 20px rgba(0,229,255,.04)}
.ci-textarea::placeholder{color:var(--text3);font-weight:400}
.save-btn{
  display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:18px;
  background:linear-gradient(135deg,var(--neon),var(--purple));border:none;border-radius:16px;
  color:#000;font-size:14px;font-weight:800;cursor:pointer;letter-spacing:.5px;
  transition:all .3s;text-transform:uppercase;
  box-shadow:0 4px 24px rgba(0,229,255,.2);position:relative;overflow:hidden;
}
.save-btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,transparent 30%,rgba(255,255,255,.15) 50%,transparent 70%);
  transform:translateX(-100%);transition:transform .4s;
}
.save-btn:hover::before{transform:translateX(100%)}
.save-btn:active{transform:scale(.96);opacity:.9}

/* ===== BOTTOM NAV ===== */
.nav{
  position:fixed;bottom:0;left:0;right:0;display:flex;
  background:rgba(6,6,15,.88);
  backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
  border-top:1px solid rgba(255,255,255,.06);z-index:100;padding:6px 12px;
  padding-bottom:max(6px,env(safe-area-inset-bottom));
}
.nav-btn{
  flex:1;padding:8px 0;text-align:center;cursor:pointer;color:var(--text3);
  font-size:10px;font-weight:700;transition:all .3s;border-radius:14px;
  letter-spacing:.3px;display:flex;flex-direction:column;align-items:center;gap:3px;
  position:relative;
}
.nav-btn.active{color:var(--neon)}
.nav-btn .icon{font-size:22px;display:block;line-height:1;transition:transform .3s}
.nav-btn.active .icon{filter:drop-shadow(0 0 10px rgba(0,229,255,.5));transform:scale(1.1)}
.nav-btn.active::after{
  content:'';position:absolute;bottom:2px;left:50%;transform:translateX(-50%);
  width:4px;height:4px;border-radius:50%;background:var(--neon);
  box-shadow:0 0 8px var(--neon);
}

/* ===== TOASTS & EFFECTS ===== */
.toast{
  position:fixed;top:24px;left:50%;transform:translateX(-50%) translateY(-30px);
  background:linear-gradient(135deg,var(--mint),#00c06b);color:#000;padding:12px 32px;border-radius:14px;
  font-size:14px;font-weight:800;opacity:0;transition:all .35s cubic-bezier(.4,0,.2,1);
  z-index:200;pointer-events:none;box-shadow:0 8px 32px rgba(11,232,129,.3);letter-spacing:.3px;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

.motiv-flash{
  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.5);
  font-family:'Space Mono',monospace;font-size:28px;font-weight:700;
  color:var(--neon);text-shadow:0 0 40px rgba(0,229,255,.5),0 0 80px rgba(0,229,255,.2);
  opacity:0;pointer-events:none;z-index:300;
  transition:all .5s cubic-bezier(.175,.885,.32,1.275);white-space:nowrap;
}
.motiv-flash.show{opacity:1;transform:translate(-50%,-50%) scale(1)}
.motiv-flash.hide{opacity:0;transform:translate(-50%,-60%) scale(1.2)}

@keyframes overdueGlow{0%,100%{box-shadow:0 0 0 rgba(255,71,87,0)}50%{box-shadow:0 0 16px rgba(255,71,87,.2)}}
.hw-item.overdue{animation:overdueGlow 2.5s ease infinite}

/* ===== CALENDAR ===== */
.cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.cal-month-label{font-size:18px;font-weight:900;color:var(--text);letter-spacing:-.3px}
.cal-nav-btn{width:40px;height:40px;border-radius:13px;border:1px solid rgba(255,255,255,.08);background:var(--surface2);cursor:pointer;color:var(--text2);font-size:18px;display:flex;align-items:center;justify-content:center;transition:all .2s}
.cal-nav-btn:active{transform:scale(.88);background:rgba(0,229,255,.1);color:var(--neon)}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px}
.cal-dow{text-align:center;font-size:10px;font-weight:800;color:var(--text3);letter-spacing:.5px;padding:0 0 10px;text-transform:uppercase}
.cal-day{min-height:56px;border-radius:13px;padding:7px 5px 5px;background:var(--surface);border:1px solid transparent;cursor:pointer;position:relative;transition:all .2s;display:flex;flex-direction:column;align-items:center}
.cal-day:active{transform:scale(.92)}
.cal-day.other-month{opacity:.25}
.cal-day.is-today{border-color:rgba(0,229,255,.3);background:rgba(0,229,255,.07);box-shadow:0 0 16px rgba(0,229,255,.08)}
.cal-day.is-today .cal-day-num{color:var(--neon);text-shadow:0 0 10px rgba(0,229,255,.4)}
.cal-day.has-hw{background:var(--surface2)}
.cal-day.selected{border-color:rgba(168,85,247,.5);background:rgba(168,85,247,.1)}
.cal-day-num{font-family:'Space Mono',monospace;font-size:13px;font-weight:700;color:var(--text2);line-height:1;margin-bottom:5px}
.cal-dots{display:flex;flex-wrap:wrap;gap:2px;justify-content:center;max-width:34px}
.cal-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.cal-dot.p1{background:var(--fire);box-shadow:0 0 4px rgba(255,71,87,.5)}
.cal-dot.p2{background:var(--gold);box-shadow:0 0 4px rgba(255,195,18,.4)}
.cal-dot.p3,.cal-dot.p-none{background:var(--neon);box-shadow:0 0 4px rgba(0,229,255,.4)}
.cal-dot.done{background:rgba(255,255,255,.15);box-shadow:none}
.cal-detail{margin-top:14px;background:var(--glass);border:1px solid rgba(168,85,247,.2);border-radius:18px;padding:16px;animation:fadeUp .25s ease;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}
.cal-detail-date{font-size:11px;font-weight:800;color:var(--purple);letter-spacing:1.2px;text-transform:uppercase;margin-bottom:12px}
.cal-detail-empty{text-align:center;padding:16px;color:var(--text3);font-size:13px}
.cal-detail-item{display:flex;align-items:center;gap:12px;padding:10px 0;border-top:1px solid rgba(255,255,255,.04)}
.cal-detail-item:first-of-type{border-top:none}
.cal-detail-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.cal-detail-info{flex:1;min-width:0}
.cal-detail-name{font-size:14px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cal-detail-name.done-txt{text-decoration:line-through;color:var(--text3)}
.cal-detail-sub{font-size:11px;color:var(--text3);margin-top:2px;font-weight:500}
.cal-legend{display:flex;gap:14px;justify-content:center;margin-top:16px;flex-wrap:wrap}
.cal-legend-item{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--text3);font-weight:600}
.cal-legend-dot{width:8px;height:8px;border-radius:50%}

/* ===== HISTORY / LOG ===== */
.hist-empty{text-align:center;padding:40px 0;color:var(--text3);font-size:14px;font-weight:600;line-height:1.7}
.hist-entry{padding:18px 0;border-bottom:1px solid var(--border)}
.hist-entry:last-child{border-bottom:none}
.hist-date-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.hist-date{font-size:12px;font-weight:800;color:var(--text2);text-transform:uppercase;letter-spacing:.8px}
.hist-b3-badge{font-size:11px;font-weight:800;padding:4px 10px;border-radius:20px;letter-spacing:.3px}
.hist-b3-badge.gold{background:rgba(255,195,18,.15);color:var(--gold)}
.hist-b3-badge.cyan{background:rgba(0,229,255,.1);color:var(--neon)}
.hist-b3-badge.dim{background:rgba(255,255,255,.05);color:var(--text3)}
.hist-b3-item{display:flex;align-items:flex-start;gap:10px;margin-bottom:8px}
.hist-check{font-size:13px;flex-shrink:0;margin-top:1px;line-height:1.4}
.hist-b3-text{font-size:13px;color:var(--text2);line-height:1.45;font-weight:500}
.hist-b3-item.done .hist-b3-text{color:var(--text3);text-decoration:line-through}
.hist-b3-item.skipped .hist-b3-text{color:rgba(255,255,255,.2);font-style:italic}
.hist-hw-block{margin-top:12px;padding:12px 14px;background:var(--surface2);border-radius:12px;border:1px solid var(--border)}
.hist-hw-lbl{font-size:10px;font-weight:800;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.hist-hw-item{display:flex;align-items:center;gap:8px;font-size:12px;font-weight:600;padding:4px 0}
.hist-hw-item.done{color:var(--text3)}
.hist-hw-item.done .hist-hw-name{text-decoration:line-through}
.hist-hw-item:not(.done){color:var(--text2)}
.hist-hw-sub{color:var(--text3);font-size:11px;font-weight:500;margin-left:2px}
.hist-stats-row{display:flex;gap:8px;margin-bottom:16px}
.hist-stat{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px 12px;text-align:center}
.hist-stat-num{font-size:22px;font-weight:900;color:var(--neon);letter-spacing:-.5px}
.hist-stat-lbl{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-top:3px}
</style>
</head>
<body>

<div class="bg-layer">
  <div class="bg-orb o1"></div>
  <div class="bg-orb o2"></div>
  <div class="bg-orb o3"></div>
  <div class="bg-grid"></div>
</div>

<div class="header">
  <div class="header-top">
    <div class="avatar">TG</div>
    <div>
      <h1>Tomas Chaves</h1>
      <div class="sub" id="today-date"></div>
    </div>
  </div>
  <div class="header-meta">
    <div class="day-badge" id="day-badge"><span class="pulse"></span><span id="day-label"></span></div>
    <div class="level-badge" id="level-badge">‚≠ê LVL 1</div>
    <div class="streak-wrap" id="streak-wrap" style="display:none">
      <span class="streak-fire">üî•</span>
      <span class="streak-num" id="streak-num">0</span>
      <span class="streak-label">day streak</span>
    </div>
  </div>
  <div class="xp-bar-wrap">
    <div class="xp-bar-bg"><div class="xp-bar-fill" id="xp-fill" style="width:0%"></div></div>
    <div class="xp-labels"><span class="xp-val" id="xp-text">0 XP</span><span class="xp-goal" id="xp-goal">Next: LVL 2</span></div>
  </div>
</div>

<div class="tabs">
  <button class="tab active" data-page="plan">Today</button>
  <button class="tab" data-page="homework">HW</button>
  <button class="tab" data-page="score">Score</button>
  <button class="tab" data-page="checkin">Check-In</button>
  <button class="tab" data-page="history">Log</button>
</div>

<div class="page active" id="plan">
  <div class="card">
    <div class="card-label">üéØ The Big 3 <span class="badge badge-neon" id="big3-count">0 / 3</span></div>
    <div class="big3-item">
      <div class="big3-rank r1">1</div>
      <input class="big3-input" id="b3-1" placeholder="If I only do ONE thing today...">
      <button class="check-btn" id="b3c-1"></button>
    </div>
    <div class="big3-item">
      <div class="big3-rank r2">2</div>
      <input class="big3-input" id="b3-2" placeholder="Second priority">
      <button class="check-btn" id="b3c-2"></button>
    </div>
    <div class="big3-item">
      <div class="big3-rank r3">3</div>
      <input class="big3-input" id="b3-3" placeholder="Third priority">
      <button class="check-btn" id="b3c-3"></button>
    </div>
    <button class="b3-lock-btn" id="b3-lock-btn">LOCK IT IN üîí</button>
  </div>
  <div class="card">
    <div class="card-label" id="sched-label">‚è∞ Schedule</div>
    <div id="timeline"></div>
  </div>
</div>

<div class="page" id="homework">
  <div class="hw-stats">
    <div class="hw-stat overdue"><div class="hw-stat-num" id="hw-overdue-n">0</div><div class="hw-stat-label">Overdue</div></div>
    <div class="hw-stat pending"><div class="hw-stat-num" id="hw-pending-n">0</div><div class="hw-stat-label">Pending</div></div>
    <div class="hw-stat done"><div class="hw-stat-num" id="hw-done-n">0</div><div class="hw-stat-label">Done</div></div>
  </div>
  <div class="card" style="padding:18px">
    <div class="card-label">‚ûï Add Assignment</div>
    <div class="hw-form-row">
      <input class="hw-f-input" id="hw-f-name" placeholder="Assignment name">
    </div>
    <div class="hw-form-row">
      <select class="hw-f-input" id="hw-f-subject">
        <option value="">Subject</option>
        <option>Math</option><option>Science</option><option>English</option>
        <option>History</option><option>Spanish</option><option>PE</option><option>Other</option>
      </select>
      <select class="hw-f-input hw-f-pri" id="hw-f-pri">
        <option value="">Pri</option><option value="1">üî¥ 1</option><option value="2">üü° 2</option><option value="3">‚ö™ 3</option>
      </select>
    </div>
    <div class="hw-form-row">
      <div style="flex:1;position:relative">
        <div style="font-size:10px;font-weight:700;color:var(--text3);margin-bottom:4px;letter-spacing:.5px;text-transform:uppercase">üìÖ Due Date</div>
        <input class="hw-f-input hw-f-date" id="hw-f-due" type="date" style="width:100%">
      </div>
    </div>
    <div class="hw-form-row">
      <button class="hw-add-submit" id="hw-add-btn">ADD TO LIST + CALENDAR üìÖ</button>
    </div>
  </div>
  <div class="hw-filter-bar">
    <button class="hw-filter active" data-filter="all">All <span class="count" id="hw-all-c"></span></button>
    <button class="hw-filter" data-filter="todo">To Do <span class="count" id="hw-todo-c"></span></button>
    <button class="hw-filter" data-filter="doing">Doing <span class="count" id="hw-doing-c"></span></button>
    <button class="hw-filter" data-filter="done">Done <span class="count" id="hw-done-c"></span></button>
  </div>
  <div id="hw-list-container"></div>
  <button class="hw-sync-btn" id="hw-sync-btn">SYNC HOMEWORK üîÑ</button>
</div>

<div class="page" id="score">
  <div class="card">
    <div class="card-label">üèÜ Week of <span id="week-label"></span></div>
    <div class="score-week">
      <div class="score-day-row">
        <div></div>
        <div class="score-cat-header">Big 3</div>
        <div class="score-cat-header">Power</div>
        <div class="score-cat-header">Phone</div>
        <div class="score-cat-header">HW</div>
        <div class="score-cat-header">Pts</div>
      </div>
      <div id="score-rows"></div>
    </div>
    <div class="total-bar">
      <div class="total-label">Weekly Total</div>
      <div class="total-num" id="week-total">0<span> / 28</span></div>
    </div>
    <div class="reward-track">
      <div class="reward-bar-bg"><div class="reward-bar-fill" id="reward-fill" style="width:0%"></div></div>
      <div class="reward-markers">
        <div class="reward-marker danger"><div class="num">0</div><div class="label">‚ö†Ô∏è</div></div>
        <div class="reward-marker" id="rm-15"><div class="num">15</div><div class="label">Min</div></div>
        <div class="reward-marker" id="rm-20"><div class="num">20</div><div class="label">üéÆ Reward</div></div>
        <div class="reward-marker" id="rm-25"><div class="num">25</div><div class="label">üèÜ Elite</div></div>
        <div class="reward-marker"><div class="num">28</div><div class="label">üëë Perfect</div></div>
      </div>
    </div>
    <a class="reset-link" id="reset-week">Reset this week</a>
  </div>
</div>

<div class="page" id="checkin">
  <div class="card">
    <div class="card-label">üí¨ Sunday Check-In</div>
    <div style="color:var(--text3);font-size:13px;margin-bottom:22px;font-weight:500;line-height:1.6">15 min. Honest answers. No judgment. Level up next week.</div>
    <div class="ci-q">
      <label>1. What went well? <span>Name a win.</span></label>
      <textarea class="ci-textarea" id="ci-1" placeholder="Even small ones count."></textarea>
    </div>
    <div class="ci-q">
      <label>2. Where did I get stuck? <span>Diagnose it.</span></label>
      <textarea class="ci-textarea" id="ci-2" placeholder="Subject? Day? Phone? Tired after tennis?"></textarea>
    </div>
    <div class="ci-q">
      <label>3. Biggest thing next week? <span>What's coming.</span></label>
      <textarea class="ci-textarea" id="ci-3" placeholder="Test? Project? Big match?"></textarea>
    </div>
    <div class="ci-q">
      <label>4. One thing I'll change: <span>Just one.</span></label>
      <textarea class="ci-textarea" id="ci-4" placeholder="'Start Power Hour at 6:30 instead of 6:45'"></textarea>
    </div>
    <button class="save-btn" id="save-ci">SAVE CHECK-IN ‚úì</button>
  </div>
</div>

<div class="toast" id="toast">Saved</div>
<div class="motiv-flash" id="motiv"></div>

<!-- Cancel HW modal -->
<div id="cancel-overlay" class="cancel-overlay">
  <div class="cancel-sheet">
    <h3>Delete assignment?</h3>
    <div class="cancel-sub" id="cancel-hw-name"></div>
    <button id="cancel-confirm-delete" style="width:100%;background:rgba(255,71,87,.12);border:1px solid rgba(255,71,87,.3);border-radius:14px;padding:16px;color:#ff4757;font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:8px">üóë Yes, delete it</button>
    <button class="cancel-dismiss" id="cancel-dismiss">Keep it</button>
  </div>
</div>

<!-- Settings overlay (long-press avatar to open) -->
<div id="settings-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:500;
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);padding:24px;overflow-y:auto">
  <div style="max-width:400px;margin:60px auto 0">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
      <div style="font-size:20px;font-weight:800;color:var(--text)">Settings</div>
      <button id="close-settings" style="background:none;border:none;color:var(--text3);font-size:28px;cursor:pointer">√ó</button>
    </div>
    <div style="margin-bottom:20px">
      <label style="font-size:12px;font-weight:700;color:var(--text3);display:block;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px">Sync URL</label>
      <input id="sync-url-input" type="url" placeholder="Paste Apps Script URL here"
        style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:12px;
        padding:14px;color:var(--text);font-size:14px;outline:none">
      <div style="font-size:11px;color:var(--text3);margin-top:6px;line-height:1.5">
        This saves your homework data to the cloud. Leave blank if not set up yet.
      </div>
    </div>
    <button id="save-sync-url" style="width:100%;padding:14px;border:none;border-radius:14px;
      background:linear-gradient(135deg,var(--neon),var(--purple));color:#000;
      font-size:13px;font-weight:800;cursor:pointer;letter-spacing:.5px;text-transform:uppercase">
      Save & Sync
    </button>
    <div style="margin-top:32px;padding-top:20px;border-top:1px solid var(--border)">
      <div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">Sync Status</div>
      <div id="sync-status" style="font-size:13px;color:var(--text2)">Not configured</div>
    </div>
    <div style="margin-top:32px;padding-top:20px;border-top:1px solid var(--border)">
      <div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">Danger Zone</div>
      <div style="font-size:12px;color:var(--text3);margin-bottom:14px;line-height:1.5">Wipes all homework, Big 3, scores, and check-ins. Sync URL stays. Can't undo.</div>
      <button id="reset-all-btn" style="width:100%;padding:14px;border:1px solid rgba(255,71,87,.3);border-radius:14px;
        background:rgba(255,71,87,.08);color:var(--fire);
        font-size:13px;font-weight:800;cursor:pointer;letter-spacing:.5px;text-transform:uppercase;font-family:inherit">
        üóë Reset All Data
      </button>
    </div>
  </div>
</div>

<div class="page" id="history">
  <div class="card">
    <div class="card-label">üìñ Your Log</div>
    <div id="hist-stats-row" class="hist-stats-row"></div>
    <div id="hist-list"></div>
  </div>
</div>

<div class="nav">
  <div class="nav-btn active" data-page="plan"><span class="icon">‚ö°</span>Today</div>
  <div class="nav-btn" data-page="homework"><span class="icon">üìã</span>HW</div>
  <div class="nav-btn" data-page="score"><span class="icon">üèÜ</span>Score</div>
  <div class="nav-btn" data-page="checkin"><span class="icon">üí¨</span>Check</div>
  <div class="nav-btn" data-page="cal"><span class="icon">üìÖ</span>Cal</div>
</div>

<script>
const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s);
const CATS=['big3','power','phone','hwin'];
const now=new Date(),dayNum=now.getDay(),isHeavy=[1,2,3,4].includes(dayNum);

const HYPE=['LOCKED IN üîí','LET\'S GO üöÄ','BEAST MODE üê∫','ON FIRE üî•','UNSTOPPABLE ‚ö°','CLUTCH üéØ'];
function flashMotiv(){
  const m=$('#motiv');m.textContent=HYPE[Math.floor(Math.random()*HYPE.length)];
  m.className='motiv-flash show';
  setTimeout(()=>{m.className='motiv-flash hide'},1200);
  setTimeout(()=>{m.className='motiv-flash'},1700);
}

$('#today-date').textContent=now.toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'});
$('#day-badge').classList.add(isHeavy?'heavy':'light');
$('#day-label').textContent=isHeavy?'HEAVY DAY':'LIGHT DAY';

const S={
  heavy:[
    {t:'3:30 ‚Äì 6:00',l:'üéæ Tennis',d:'Your commitment. Non-negotiable.'},
    {t:'6:00 ‚Äì 6:30',l:'Decompress & Eat',d:'No homework yet ‚Äî recharge first.'},
    {t:'6:25',l:'üìã Brain Dump',d:'2 min. Everything due. Tag 1-2-3.'},
    {t:'6:30 ‚Äì 7:30',l:'‚ö° Power Hour',d:'Hardest first. Phone gone. 25/5 splits.'},
    {t:'7:30 ‚Äì 7:45',l:'Break',d:'Phone time earned.'},
    {t:'7:45 ‚Äì 8:30',l:'üìö Finish Block',d:'Remaining HW, review, prep tomorrow.'},
    {t:'8:30 ‚Äì 9:30',l:'Free Time',d:'Phone, games ‚Äî you earned it.'},
    {t:'9:30',l:'üì± Phone Out',d:'Charges outside your room.'},
    {t:'10:00',l:'Lights Out',d:''}
  ],
  fri:[
    {t:'After School',l:'üéâ Freedom',d:'But first ‚Äî list weekend HW. 5 min.'},
    {t:'Evening',l:'Your Call',d:'You earned the week.'},
    {t:'9:30',l:'üì± Phone Out',d:'Even Fridays.'}
  ],
  sat:[
    {t:'Morning',l:'Free',d:'Sleep in. Your time.'},
    {t:'1:00 ‚Äì 3:00',l:'üìö Weekend Work Block',d:'Phone-free. Knock it out.'},
    {t:'After 3:00',l:'Free',d:'Rest of the day is yours.'}
  ],
  sun:[
    {t:'Daytime',l:'Free',d:'Recharge.'},
    {t:'After Dinner',l:'30-Min Review',d:'Prep backpack. Check planner.'},
    {t:'7:00 PM',l:'üí¨ Check-In with Dad',d:'15 min. The 4 questions.'},
    {t:'9:30',l:'üì± Phone Out',d:''}
  ]
};
const sched=dayNum>=1&&dayNum<=4?S.heavy:dayNum===5?S.fri:dayNum===6?S.sat:S.sun;
$('#sched-label').innerHTML='‚è∞ '+(isHeavy?'Heavy':'Light')+' Day Schedule';
const tl=$('#timeline');
sched.forEach(s=>{const d=document.createElement('div');d.className='tl-item';
d.innerHTML=`<div class="tl-time">${s.t}</div><div><div class="tl-label">${s.l}</div>${s.d?`<div class="tl-desc">${s.d}</div>`:''}</div>`;tl.appendChild(d)});

function showPage(id){$$('.page').forEach(p=>p.classList.remove('active'));$$('.tab,.nav-btn').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');$$(`[data-page="${id}"]`).forEach(t=>t.classList.add('active'))}
$$('.tab,.nav-btn').forEach(t=>t.addEventListener('click',()=>showPage(t.dataset.page)));

function save(k,v){try{localStorage.setItem('tg_'+k,JSON.stringify(v))}catch(e){}}
function load(k,d){try{const v=localStorage.getItem('tg_'+k);return v?JSON.parse(v):d}catch(e){return d}}
function toast(m){const t=$('#toast');t.textContent=m||'Saved ‚úì';t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
function weekKey(){const d=new Date(),day=d.getDay(),diff=d.getDate()-day+(day===0?-6:1);return new Date(d.setDate(diff)).toISOString().slice(0,10)}
const todayKey=new Date().toISOString().slice(0,10),wk=weekKey();
(()=>{const mon=new Date(wk+'T12:00:00'),sun=new Date(wk+'T12:00:00');sun.setDate(mon.getDate()+6);
const fmt=d=>d.toLocaleDateString('en-US',{month:'short',day:'numeric'});
const el=document.getElementById('week-label');if(el)el.textContent=fmt(mon)+' ‚Äì '+fmt(sun);})();

/* XP System */
const XP_PER_CHECK=15, XP_PER_HW_DONE=10, XP_PER_SCORE=20;
const LEVELS=[0,100,250,500,800,1200,1800,2500,3500,5000];
const LEVEL_NAMES=['Rookie','Grinder','Focused','Locked In','Machine','Elite','Beast','Legend','GOAT','Transcendent'];

function addXP(amount){let xp=load('xp_total',0);xp+=amount;save('xp_total',xp);updateXPBar(xp)}
function getLevel(xp){let lvl=0;for(let i=LEVELS.length-1;i>=0;i--){if(xp>=LEVELS[i]){lvl=i;break}}return lvl}
function updateXPBar(xp){
  if(xp===undefined)xp=load('xp_total',0);
  const lvl=getLevel(xp);const curr=LEVELS[lvl];const next=LEVELS[lvl+1]||LEVELS[lvl]+1000;
  const pct=Math.min(100,Math.round((xp-curr)/(next-curr)*100));
  $('#xp-fill').style.width=pct+'%';
  $('#xp-text').textContent=xp+' XP';
  $('#xp-goal').textContent=lvl<LEVELS.length-1?'Next: LVL '+(lvl+2):'MAX LEVEL';
  $('#level-badge').innerHTML='‚≠ê LVL '+(lvl+1)+' ‚Äî '+LEVEL_NAMES[lvl];
}

function updateStreak(){
  const streak=load('streak',{count:0,lastDate:''});
  const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);const yKey=yesterday.toISOString().slice(0,10);
  if(streak.lastDate===todayKey||streak.lastDate===yKey){
    if(streak.count>0){$('#streak-wrap').style.display='inline-flex';$('#streak-num').textContent=streak.count}
  } else if(streak.lastDate&&streak.lastDate!==yKey&&streak.lastDate!==todayKey){
    streak.count=0;save('streak',streak);
  }
}
function bumpStreak(){
  const streak=load('streak',{count:0,lastDate:''});
  if(streak.lastDate!==todayKey){streak.count++;streak.lastDate=todayKey;save('streak',streak);
  $('#streak-wrap').style.display='inline-flex';$('#streak-num').textContent=streak.count}
}
updateXPBar();updateStreak();

/* Big 3 */
const big3=load('big3_'+todayKey,{items:['','',''],checks:[false,false,false]});
function updateB3(){
  const done=big3.checks.filter(Boolean).length;
  $('#big3-count').textContent=done+' / 3';
  $('#big3-count').className='badge '+(done===3?'badge-gold':'badge-neon');
}
for(let i=1;i<=3;i++){
  const inp=$(`#b3-${i}`),btn=$(`#b3c-${i}`);inp.value=big3.items[i-1];
  if(big3.checks[i-1])btn.classList.add('checked');
  inp.addEventListener('input',()=>{big3.items[i-1]=inp.value;save('big3_'+todayKey,big3)});
  btn.addEventListener('click',()=>{
    const was=big3.checks[i-1];big3.checks[i-1]=!was;btn.classList.toggle('checked');
    save('big3_'+todayKey,big3);updateB3();
    if(!was){addXP(XP_PER_CHECK);flashMotiv();bumpStreak()}
  });
}
updateB3();

/* Lock It In - Big 3 sync */
const APPS_SCRIPT_URL = localStorage.getItem('tg_sync_url') || 'https://script.google.com/macros/s/AKfycbxE1AkWy8gnDUSL6K0CuwCnExlYXVu8XFBtclp8QBCByQlFCPj9KGHDEE9mOFSSHUNa/exec';

function syncBig3() {
  if (!APPS_SCRIPT_URL) return;
  const payload = {
    action: 'sync_big3',
    date: todayKey,
    big3: {
      items: big3.items,
      checks: big3.checks
    }
  };
  try {
    fetch(APPS_SCRIPT_URL, {
      method: 'POST', mode: 'no-cors',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    }).catch(() => {});
  } catch(e) {}
}

$('#b3-lock-btn').addEventListener('click', () => {
  const filled = big3.items.filter(s => s.trim()).length;
  if (filled === 0) { toast('Set at least one goal first!'); return; }
  const btn = $('#b3-lock-btn');
  btn.classList.add('syncing');
  btn.textContent = 'LOCKING IN...';
  syncBig3();
  setTimeout(() => {
    btn.classList.remove('syncing');
    btn.classList.add('locked');
    btn.textContent = 'LOCKED IN ‚úÖ';
    addXP(5);
    bumpStreak();
    // auto-check Big 3 score toggle for today
    const _dNames=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],_dNums=[1,2,3,4,5,6,0];
    const _todayName=_dNames[_dNums.indexOf(now.getDay())];
    const _b3key=_todayName+'_big3';
    if(!scores[_b3key]){scores[_b3key]=true;save('scores_'+wk,scores);if(typeof renderScores==='function')renderScores();}
    const s=load('streak',{count:0});
    toast('Goals locked in! +5 XP üîí' + (s.count>1?' üî•'+s.count+' day streak!':''));
    setTimeout(() => { btn.classList.remove('locked'); btn.textContent = 'LOCK IT IN üîí'; }, 2500);
  }, 1500);
});

/* ===== HOMEWORK TRACKER ===== */
function syncToSheet(action, hw) {
  if (!APPS_SCRIPT_URL) return;
  const payload = { action: action, hw: hw || {} };
  try {
    fetch(APPS_SCRIPT_URL, {
      method: 'POST', mode: 'no-cors',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    }).catch(() => {});
  } catch(e) {}
}
function fullSync() {
  if (!APPS_SCRIPT_URL) return;
  try {
    fetch(APPS_SCRIPT_URL, {
      method: 'POST', mode: 'no-cors',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({ action: 'sync_all', all: hwData })
    }).catch(() => {});
  } catch(e) {}
}

let hwData=load('hw_all',[]);
let hwFilter='all';

function hwDateClass(due){
  if(!due)return '';
  const t=new Date(todayKey+'T00:00:00'),d=new Date(due+'T00:00:00');
  const diff=Math.round((d-t)/(86400000));
  if(diff<0)return 'overdue';
  if(diff===0)return 'today';
  if(diff===1)return 'tomorrow';
  return 'upcoming';
}
function hwDateLabel(due){
  if(!due)return '';
  const t=new Date(todayKey+'T00:00:00'),d=new Date(due+'T00:00:00');
  const diff=Math.round((d-t)/(86400000));
  if(diff<0)return Math.abs(diff)+' day'+(Math.abs(diff)>1?'s':'')+' overdue';
  if(diff===0)return 'Due today';
  if(diff===1)return 'Due tomorrow';
  return 'Due '+d.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
}

function openCalendar(hw){
  if(!hw.due){toast('Set a due date first');return}
  const title=(hw.subject?hw.subject+': ':'')+hw.name;
  const details='Priority: '+(hw.pri||'\u2014')+'\\nAdded from TG Game Plan';
  const uid=Date.now()+'@tg-gameplan';
  const pad=n=>String(n).padStart(2,'0');
  const fmt=d=>d.getFullYear()+pad(d.getMonth()+1)+pad(d.getDate())+'T'+pad(d.getHours())+pad(d.getMinutes())+'00';
  // Event starts 8 AM on due date
  const parts=hw.due.split('-').map(Number);
  const start=new Date(parts[0],parts[1]-1,parts[2],8,0,0);
  const end=new Date(parts[0],parts[1]-1,parts[2],9,0,0);
  // Build VALARM blocks
  const alarms=[];
  const addAlarm=(trigger,desc)=>alarms.push('BEGIN:VALARM\r\nACTION:DISPLAY\r\nDESCRIPTION:'+desc+'\r\nTRIGGER:'+trigger+'\r\nEND:VALARM');
  // Day-before reminders: 5 PM, 6 PM, 7 PM (8 AM due date minus 15/14/13h)
  addAlarm('-PT15H',title+' \u2014 due tomorrow (5 PM)');
  addAlarm('-PT14H',title+' \u2014 due tomorrow (6 PM)');
  addAlarm('-PT13H',title+' \u2014 due tomorrow (7 PM)');
  // Daily 7 PM reminders from tomorrow through 2 days before due date
  const today=new Date(); today.setHours(0,0,0,0);
  const dueDay=new Date(parts[0],parts[1]-1,parts[2],0,0,0);
  let day=new Date(today); day.setDate(day.getDate()+1);
  const twoDaysBefore=new Date(dueDay); twoDaysBefore.setDate(twoDaysBefore.getDate()-2);
  let count=0;
  while(day<=twoDaysBefore && count<14){
    const rem=new Date(day); rem.setHours(19,0,0,0);
    const diffH=Math.round((rem-start)/3600000);
    const trigger=(diffH<0?'-PT'+Math.abs(diffH):'PT'+diffH)+'H';
    const label=day.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
    addAlarm(trigger,title+' due '+label);
    day.setDate(day.getDate()+1); count++;
  }
  const lines=[
    'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//TG Game Plan//EN',
    'BEGIN:VEVENT',
    'UID:'+uid,
    'DTSTART:'+fmt(start),
    'DTEND:'+fmt(end),
    'SUMMARY:'+title.replace(/,/g,'\\,'),
    'DESCRIPTION:'+details,
    ...alarms,
    'END:VEVENT','END:VCALENDAR'
  ];
  const ics=lines.join('\r\n');
  const blob=new Blob([ics],{type:'text/calendar;charset=utf-8'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=title.replace(/[^a-z0-9]/gi,'_').slice(0,40)+'.ics';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  setTimeout(()=>URL.revokeObjectURL(url),1000);
}

function updateHWStats(){
  let overdue=0,pending=0,done=0;
  hwData.forEach(h=>{
    if(h.status==='done'){done++;return}
    const cls=hwDateClass(h.due);
    if(cls==='overdue')overdue++;
    pending++;
  });
  $('#hw-overdue-n').textContent=overdue;
  $('#hw-pending-n').textContent=pending;
  $('#hw-done-n').textContent=done;
  const all=hwData.length;
  const todo=hwData.filter(h=>!h.status||h.status==='not-started').length;
  const doing=hwData.filter(h=>h.status==='in-progress').length;
  const doneC=hwData.filter(h=>h.status==='done').length;
  $('#hw-all-c').textContent=all;$('#hw-todo-c').textContent=todo;
  $('#hw-doing-c').textContent=doing;$('#hw-done-c').textContent=doneC;
}

function renderHW(){
  const container=$('#hw-list-container');container.innerHTML='';
  updateHWStats();
  let items=hwData.map((h,i)=>({...h,idx:i}));
  if(hwFilter==='todo')items=items.filter(h=>!h.status||h.status==='not-started');
  else if(hwFilter==='doing')items=items.filter(h=>h.status==='in-progress');
  else if(hwFilter==='done')items=items.filter(h=>h.status==='done');

  if(items.length===0){
    container.innerHTML=`<div class="hw-empty"><span class="hw-empty-icon">${hwFilter==='done'?'üèÜ':'üìã'}</span>${hwFilter==='done'?'No completed assignments yet':'No assignments ‚Äî add one above!'}</div>`;
    return;
  }

  items.sort((a,b)=>{
    const aD=a.status==='done'?1:0, bD=b.status==='done'?1:0;
    if(aD!==bD)return aD-bD;
    const aP=a.pri||9,bP=b.pri||9;
    const aDate=a.due||'9999',bDate=b.due||'9999';
    if(aDate!==bDate)return aDate.localeCompare(bDate);
    return aP-bP;
  });

  const sections={overdue:[],today:[],upcoming:[],noduedate:[],completed:[]};
  items.forEach(h=>{
    if(h.status==='done'){sections.completed.push(h);return}
    const cls=hwDateClass(h.due);
    if(cls==='overdue')sections.overdue.push(h);
    else if(cls==='today')sections.today.push(h);
    else if(!h.due)sections.noduedate.push(h);
    else sections.upcoming.push(h);
  });

  function renderSection(label,cssClass,items){
    if(items.length===0)return;
    const sec=document.createElement('div');sec.className='hw-list-section';
    sec.innerHTML=`<div class="hw-section-label ${cssClass}"><span class="dot"></span>${label}</div>`;
    items.forEach(h=>{
      const el=document.createElement('div');
      const isDone=h.status==='done';
      const isInProg=h.status==='in-progress';
      const dueClass=hwDateClass(h.due);
      el.className='hw-item'+(isDone?' is-done':'')+(dueClass==='overdue'&&!isDone?' overdue':'')+(dueClass==='today'&&!isDone?' today':'');
      el.innerHTML=`
        <div class="hw-item-top">
          <button class="hw-item-check${isDone?' checked':''}${isInProg?' in-prog':''}" data-idx="${h.idx}"></button>
          <div class="hw-item-info">
            <div class="hw-item-name">${esc(h.name||'Untitled')}</div>
            <div class="hw-item-meta">
              ${h.subject?`<span class="hw-tag hw-tag-subject">${h.subject}</span>`:''}
              ${h.due?`<span class="hw-tag hw-tag-due ${dueClass}">${hwDateLabel(h.due)}</span>`:''}
              ${h.pri?`<span class="hw-tag hw-tag-pri p${h.pri}">P${h.pri}</span>`:''}
            </div>
          </div>
          <div class="hw-item-actions">
            ${h.due&&!isDone?`<button class="hw-action-btn cal" data-idx="${h.idx}" title="Add to Calendar">üìÖ</button>`:''}
            <button class="hw-action-btn del" data-idx="${h.idx}" title="Delete">√ó</button>
          </div>
        </div>`;
      sec.appendChild(el);
    });
    container.appendChild(sec);
  }
  renderSection('üî¥ OVERDUE','overdue',sections.overdue);
  renderSection('üü° DUE TODAY','today',sections.today);
  renderSection('üìÖ UPCOMING','upcoming',sections.upcoming);
  if(sections.noduedate.length)renderSection('üìå NO DUE DATE','upcoming',sections.noduedate);
  renderSection('‚úÖ COMPLETED','completed',sections.completed);

  container.querySelectorAll('.hw-item-check').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const i=parseInt(btn.dataset.idx);
      const states=['not-started','in-progress','done'];
      const cur=hwData[i].status||'not-started';
      const next=states[(states.indexOf(cur)+1)%3];
      const wasDone=cur==='done';
      hwData[i].status=next;
      save('hw_all',hwData);
      syncToSheet(next==='done'?'completed':'status_change', hwData[i]);
      fullSync();
      renderHW();
      if(next==='done'&&!wasDone){
        addXP(XP_PER_HW_DONE);flashMotiv();bumpStreak();toast('Assignment done! +10 XP');
        // auto-check HW score toggle for the assignment's DUE DATE day
        const _dueStr=hwData[i].due; // "YYYY-MM-DD"
        if(_dueStr){
          // only apply within the current week (Mon‚ÄìSun)
          const _mon=new Date(wk+'T12:00:00'),_sun=new Date(wk+'T12:00:00');
          _sun.setDate(_mon.getDate()+6);
          const _due=new Date(_dueStr+'T12:00:00');
          if(_due>=_mon&&_due<=_sun){
            const _dN=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],_dI=[1,2,3,4,5,6,0];
            const _dn=_dN[_dI.indexOf(_due.getDay())];
            // all assignments due on this specific date must be done
            const _dayDone=hwData.filter(h=>h.due===_dueStr).every(h=>h.status==='done');
            if(_dayDone){const _hwk=_dn+'_hwin';
              if(!scores[_hwk]){scores[_hwk]=true;save('scores_'+wk,scores);if(typeof renderScores==='function')renderScores();toast('All '+_dn+' HW done! Score updated üìã‚úÖ');}}
          }
        }
      }
    });
  });
  container.querySelectorAll('.hw-action-btn.cal').forEach(btn=>{
    btn.addEventListener('click',()=>openCalendar(hwData[parseInt(btn.dataset.idx)]));
  });
  container.querySelectorAll('.hw-action-btn.del').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const idx=parseInt(btn.dataset.idx);
      const hw=hwData[idx];
      showCancelModal(idx);
    });
  });
}

function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}

$('#hw-add-btn').addEventListener('click',()=>{
  const name=$('#hw-f-name').value.trim();
  if(!name){toast('Enter assignment name');$('#hw-f-name').focus();return}
  if(!$('#hw-f-due').value){toast('Set a due date ‚ö†Ô∏è');$('#hw-f-due').focus();return}
  const hw={
    name:name,
    subject:$('#hw-f-subject').value,
    due:$('#hw-f-due').value,
    pri:$('#hw-f-pri').value,
    status:'not-started',
    added:todayKey,
    addedAt:Date.now()
  };
  hwData.push(hw);
  save('hw_all',hwData);
  syncToSheet('added', hw);
  $('#hw-f-name').value='';$('#hw-f-subject').value='';$('#hw-f-due').value='';$('#hw-f-pri').value='';
  renderHW();
  addXP(5);toast('Added! +5 XP');
  if(hw.due){
    setTimeout(()=>openCalendar(hw),400);
  }
});

$$('.hw-filter').forEach(btn=>{
  btn.addEventListener('click',()=>{
    $$('.hw-filter').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');hwFilter=btn.dataset.filter;renderHW();
  });
});

renderHW();

$('#hw-sync-btn').addEventListener('click',()=>{
  const btn=$('#hw-sync-btn');
  btn.classList.add('syncing');
  btn.textContent='SYNCING...';
  fullSync();
  setTimeout(()=>{
    btn.classList.remove('syncing');
    btn.textContent='SYNCED ‚úÖ';
    addXP(3);toast('Homework synced! +3 XP');
    setTimeout(()=>{btn.textContent='SYNC HOMEWORK üîÑ'},2500);
  },1500);
});

/* Scoreboard */
let scores=load('scores_'+wk,{});
let _scoresSyncTimer=null;
function syncScores(){
  if(!APPS_SCRIPT_URL)return;
  clearTimeout(_scoresSyncTimer);
  _scoresSyncTimer=setTimeout(()=>{
    const total=Object.values(scores).filter(v=>v).length;
    fetch(APPS_SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'text/plain'},
      body:JSON.stringify({action:'sync_scores',week:wk,scores:scores,total:total})}).catch(()=>{});
  },1500);
}
function renderScores(){const c=$('#score-rows');c.innerHTML='';let total=0;
const days=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],nums=[1,2,3,4,5,6,0];
days.forEach((day,di)=>{const row=document.createElement('div');row.className='score-day-row';
const isToday=nums[di]===now.getDay();
if(isToday)row.classList.add('today-row');
const lbl=document.createElement('div');lbl.className='score-day-label'+(isToday?' is-today':'');lbl.textContent=isToday?'‚Üí '+day:day;row.appendChild(lbl);
let dp=0;CATS.forEach(cat=>{const cell=document.createElement('div');cell.style.display='flex';cell.style.justifyContent='center';
const key=day+'_'+cat,on=scores[key]||false;
const btn=document.createElement('button');btn.className='score-toggle'+(on?' yes':'');
btn.addEventListener('click',()=>{const was=scores[key];scores[key]=!was;save('scores_'+wk,scores);renderScores();syncScores();if(!was){addXP(XP_PER_SCORE);bumpStreak()}});
cell.appendChild(btn);row.appendChild(cell);if(on)dp++});
const pts=document.createElement('div');pts.className='score-day-pts '+(dp>=3?'high':dp>=2?'mid':'low');pts.textContent=dp;row.appendChild(pts);
c.appendChild(row);total+=dp});
const te=$('#week-total');te.innerHTML=total+'<span> / 28</span>';te.className='total-num '+(total>=20?'good':total>=15?'mid':'bad');
const pct=Math.min(100,Math.round(total/28*100));const fill=$('#reward-fill');fill.style.width=pct+'%';
fill.className='reward-bar-fill '+(total>=25?'max':total>=20?'high':total>=15?'mid':'low');
if(total>=20)$('#rm-20').classList.add('active');else $('#rm-20').classList.remove('active');
if(total>=25)$('#rm-25').classList.add('active');else $('#rm-25').classList.remove('active');
if(total<15)$('#rm-15').classList.add('danger');else $('#rm-15').classList.remove('danger');
}
renderScores();
$('#reset-week').addEventListener('click',()=>{if(confirm('Reset scores?')){scores={};save('scores_'+wk,scores);renderScores();toast('Reset')}});

/* Check-in */
const ci=load('ci_'+wk,{});
for(let i=1;i<=4;i++){const ta=$(`#ci-${i}`);ta.value=ci['q'+i]||'';ta.addEventListener('input',()=>{ci['q'+i]=ta.value;save('ci_'+wk,ci)})}
$('#save-ci').addEventListener('click',()=>{
  save('ci_'+wk,ci);addXP(50);toast('Check-in saved üî•');flashMotiv();
  if(APPS_SCRIPT_URL){
    fetch(APPS_SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'text/plain'},
      body:JSON.stringify({action:'sync_checkin',week:wk,checkin:ci})}).catch(()=>{});
  }
});

/* Settings panel ‚Äî long-press avatar */
let avatarTimer=null;
const avatar=$('.avatar');
avatar.addEventListener('touchstart',()=>{avatarTimer=setTimeout(()=>{$('#settings-overlay').style.display='block';
  $('#sync-url-input').value=localStorage.getItem('tg_sync_url')||'';
  $('#sync-status').textContent=APPS_SCRIPT_URL?'Connected ‚Äî syncing to Google Sheet':'Not configured';
},800)},{passive:true});
avatar.addEventListener('touchend',()=>clearTimeout(avatarTimer));
avatar.addEventListener('touchmove',()=>clearTimeout(avatarTimer));
/* Also double-click for desktop */
avatar.addEventListener('dblclick',()=>{$('#settings-overlay').style.display='block';
  $('#sync-url-input').value=localStorage.getItem('tg_sync_url')||'';
  $('#sync-status').textContent=APPS_SCRIPT_URL?'Connected ‚Äî syncing to Google Sheet':'Not configured';
});
$('#close-settings').addEventListener('click',()=>{$('#settings-overlay').style.display='none'});
$('#save-sync-url').addEventListener('click',()=>{
  const url=$('#sync-url-input').value.trim();
  localStorage.setItem('tg_sync_url',url);
  toast(url?'Sync URL saved! Syncing now...':'Sync URL cleared');
  $('#sync-status').textContent=url?'Connected ‚Äî syncing to Google Sheet':'Not configured';
  if(url){setTimeout(()=>{location.reload()},500)}
});

$('#reset-all-btn').addEventListener('click',()=>{
  if(!confirm('Reset EVERYTHING? This clears all homework, goals, scores, and check-ins. This cannot be undone.')) return;
  const syncUrl = localStorage.getItem('tg_sync_url');
  const keys = [];
  for(let i=0;i<localStorage.length;i++) keys.push(localStorage.key(i));
  keys.filter(k=>k.startsWith('tg_')).forEach(k=>localStorage.removeItem(k));
  if(syncUrl) localStorage.setItem('tg_sync_url', syncUrl);
  toast('All data cleared. Starting fresh üßπ');
  setTimeout(()=>location.reload(), 800);
});

/* Auto-sync on page load if URL configured */
if(APPS_SCRIPT_URL){setTimeout(fullSync,2000)}
/* ===== CANCEL MODAL ===== */
let _cancelIdx = null;
function showCancelModal(idx){
  _cancelIdx = idx;
  const hw = hwData[idx];
  $('#cancel-hw-name').textContent = hw.name || 'this assignment';
  $('#cancel-overlay').classList.add('open');
}
function closeCancelModal(){ $('#cancel-overlay').classList.remove('open'); _cancelIdx=null; }

$('#cancel-dismiss').addEventListener('click', closeCancelModal);
$('#cancel-overlay').addEventListener('click', e => { if(e.target===$('#cancel-overlay')) closeCancelModal(); });

$('#cancel-confirm-delete').addEventListener('click', () => {
  if(_cancelIdx===null) return;
  const hw = hwData[_cancelIdx];
  hwData.splice(_cancelIdx, 1);
  save('hw_all', hwData);
  syncToSheet('cancelled', {...hw, reason:'Deleted', cancelledAt: new Date().toISOString()});
  fullSync();
  renderHW();
  closeCancelModal();
  toast('Deleted ‚úì');
});

/* ===== CALENDAR ===== */
let calYear = now.getFullYear(), calMonth = now.getMonth(), calSelectedDay = null;

// Insert calendar page HTML dynamically
(function(){
  const calPage = document.createElement('div');
  calPage.id = 'cal';
  calPage.className = 'page';
  calPage.innerHTML = `
    <div class="card">
      <div class="cal-header">
        <button class="cal-nav-btn" id="cal-prev">‚Äπ</button>
        <div class="cal-month-label" id="cal-month-label"></div>
        <button class="cal-nav-btn" id="cal-next">‚Ä∫</button>
      </div>
      <div class="cal-grid" id="cal-grid"></div>
      <div id="cal-detail" style="display:none"></div>
      <div class="cal-legend">
        <div class="cal-legend-item"><div class="cal-legend-dot" style="background:var(--fire);box-shadow:0 0 4px rgba(255,71,87,.5)"></div>Priority 1</div>
        <div class="cal-legend-item"><div class="cal-legend-dot" style="background:var(--gold)"></div>Priority 2</div>
        <div class="cal-legend-item"><div class="cal-legend-dot" style="background:var(--neon)"></div>Priority 3+</div>
        <div class="cal-legend-item"><div class="cal-legend-dot" style="background:rgba(255,255,255,.15)"></div>Done</div>
      </div>
    </div>
  `;
  // Insert before the nav
  document.querySelector('.nav').before(calPage);
})();

function renderCalendar() {
  const MONTHS = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  const DOW = ['SUN','MON','TUE','WED','THU','FRI','SAT'];

  $('#cal-month-label').textContent = MONTHS[calMonth] + ' ' + calYear;

  const grid = $('#cal-grid');
  grid.innerHTML = '';

  // Day of week headers
  DOW.forEach(d => {
    const el = document.createElement('div');
    el.className = 'cal-dow';
    el.textContent = d;
    grid.appendChild(el);
  });

  // Build a map: dateKey -> [hw items due that day]
  const duemap = {};
  (load('hw_all', [])).forEach(h => {
    if (!h.due) return;
    if (!duemap[h.due]) duemap[h.due] = [];
    duemap[h.due].push(h);
  });

  const firstDay = new Date(calYear, calMonth, 1).getDay();
  const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();
  const daysInPrev = new Date(calYear, calMonth, 0).getDate();
  const todayStr = new Date().toISOString().slice(0, 10);

  // Prev month filler
  for (let i = firstDay - 1; i >= 0; i--) {
    const d = daysInPrev - i;
    const m = calMonth === 0 ? 11 : calMonth - 1;
    const y = calMonth === 0 ? calYear - 1 : calYear;
    const key = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    grid.appendChild(makeDayCell(d, key, true, duemap, todayStr));
  }

  // Current month
  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    grid.appendChild(makeDayCell(d, key, false, duemap, todayStr));
  }

  // Next month filler
  const total = firstDay + daysInMonth;
  const remaining = total % 7 === 0 ? 0 : 7 - (total % 7);
  for (let d = 1; d <= remaining; d++) {
    const m = calMonth === 11 ? 0 : calMonth + 1;
    const y = calMonth === 11 ? calYear + 1 : calYear;
    const key = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    grid.appendChild(makeDayCell(d, key, true, duemap, todayStr));
  }

  // Re-render selected detail if a day was selected
  if (calSelectedDay) showCalDetail(calSelectedDay, duemap);
}

function makeDayCell(dayNum, key, otherMonth, duemap, todayStr) {
  const hwList = duemap[key] || [];
  const el = document.createElement('div');
  el.className = 'cal-day' +
    (otherMonth ? ' other-month' : '') +
    (key === todayStr ? ' is-today' : '') +
    (hwList.length > 0 ? ' has-hw' : '') +
    (key === calSelectedDay ? ' selected' : '');
  el.dataset.key = key;

  const numEl = document.createElement('div');
  numEl.className = 'cal-day-num';
  numEl.textContent = dayNum;
  el.appendChild(numEl);

  if (hwList.length > 0) {
    const dotsEl = document.createElement('div');
    dotsEl.className = 'cal-dots';
    // Show up to 6 dots
    hwList.slice(0, 6).forEach(h => {
      const dot = document.createElement('div');
      const isDone = h.status === 'done';
      dot.className = isDone ? 'cal-dot done' : ('cal-dot ' + (h.pri == 1 ? 'p1' : h.pri == 2 ? 'p2' : 'p3'));
      dotsEl.appendChild(dot);
    });
    if (hwList.length > 6) {
      const more = document.createElement('div');
      more.style.cssText = 'font-size:8px;font-weight:800;color:var(--text3);width:100%;text-align:center;line-height:1';
      more.textContent = '+' + (hwList.length - 6);
      dotsEl.appendChild(more);
    }
    el.appendChild(dotsEl);
  }

  el.addEventListener('click', () => {
    calSelectedDay = (calSelectedDay === key) ? null : key;
    $$('.cal-day').forEach(d => d.classList.remove('selected'));
    if (calSelectedDay) el.classList.add('selected');
    // Rebuild duemap for detail
    const dm = {};
    (load('hw_all', [])).forEach(h => { if (h.due) { if (!dm[h.due]) dm[h.due] = []; dm[h.due].push(h); } });
    showCalDetail(calSelectedDay, dm);
  });

  return el;
}

function showCalDetail(key, duemap) {
  const det = $('#cal-detail');
  if (!key) { det.style.display = 'none'; return; }

  const hwList = duemap[key] || [];
  const d = new Date(key + 'T12:00:00');
  const dateLabel = d.toLocaleDateString('en-US', {weekday:'long', month:'long', day:'numeric'});

  let html = `<div class="cal-detail"><div class="cal-detail-date">${dateLabel}</div>`;
  if (hwList.length === 0) {
    html += `<div class="cal-detail-empty">No assignments due ‚Äî free day ‚ú®</div>`;
  } else {
    // Sort: undone first by priority
    const sorted = [...hwList].sort((a,b) => {
      const ad = a.status==='done'?1:0, bd = b.status==='done'?1:0;
      if (ad !== bd) return ad - bd;
      return (a.pri||9) - (b.pri||9);
    });
    sorted.forEach(h => {
      const isDone = h.status === 'done';
      const dotClass = isDone ? 'done' : (h.pri==1?'p1':h.pri==2?'p2':'p3');
      const dotStyle = isDone ? 'background:rgba(255,255,255,.15)' :
        (h.pri==1 ? 'background:var(--fire);box-shadow:0 0 6px rgba(255,71,87,.5)' :
         h.pri==2 ? 'background:var(--gold)' : 'background:var(--neon);box-shadow:0 0 6px rgba(0,229,255,.4)');
      html += `<div class="cal-detail-item">
        <div class="cal-detail-dot" style="${dotStyle}"></div>
        <div class="cal-detail-info">
          <div class="cal-detail-name${isDone?' done-txt':''}">${esc(h.name||'Untitled')}</div>
          ${h.subject?`<div class="cal-detail-sub">${esc(h.subject)}${h.pri?` ¬∑ P${h.pri}`:''}${isDone?' ¬∑ ‚úì Done':''}</div>`:''}
        </div>
      </div>`;
    });
  }
  html += '</div>';
  det.innerHTML = html;
  det.style.display = 'block';
}

$('#cal-prev').addEventListener('click', () => {
  calMonth--; if (calMonth < 0) { calMonth = 11; calYear--; }
  calSelectedDay = null; renderCalendar();
});
$('#cal-next').addEventListener('click', () => {
  calMonth++; if (calMonth > 11) { calMonth = 0; calYear++; }
  calSelectedDay = null; renderCalendar();
});

// Re-render calendar when switching to it so it reflects latest HW data
$$('[data-page="cal"]').forEach(btn => btn.addEventListener('click', () => renderCalendar()));

renderCalendar();

/* ===== HISTORY / LOG ===== */
(()=>{
  function renderHistory(){
    const statsRow = document.getElementById('hist-stats-row');
    const list = document.getElementById('hist-list');
    list.innerHTML = '';
    statsRow.innerHTML = '';

    const hwAll = load('hw_all', []);

    // Collect all unique past dates from Big3 keys AND hw added dates
    const dateSet = new Set();
    for(let i=0;i<localStorage.length;i++){
      const key=localStorage.key(i);
      if(key && key.startsWith('tg_big3_')){
        const d=key.replace('tg_big3_','');
        if(d !== todayKey) dateSet.add(d);
      }
    }
    hwAll.forEach(h=>{
      if(h.added && h.added !== todayKey) dateSet.add(h.added);
    });

    const dates = [...dateSet].sort((a,b)=>b.localeCompare(a));

    if(dates.length === 0 && hwAll.length === 0){
      list.innerHTML='<div class="hist-empty">No history yet.<br>Come back tomorrow üí™</div>';
      return;
    }

    // Stats
    const totalHWDone = hwAll.filter(h=>h.status==='done').length;
    const totalHW = hwAll.length;
    const perfectDays = dates.filter(date=>{
      const b3=load('big3_'+date,null);
      return b3 && b3.checks.filter(Boolean).length===3;
    }).length;

    statsRow.innerHTML=`
      <div class="hist-stat"><div class="hist-stat-num">${dates.length}</div><div class="hist-stat-lbl">Days Logged</div></div>
      <div class="hist-stat"><div class="hist-stat-num" style="color:var(--gold)">${perfectDays}</div><div class="hist-stat-lbl">Perfect Days</div></div>
      <div class="hist-stat"><div class="hist-stat-num" style="color:var(--fire)">${totalHWDone}/${totalHW}</div><div class="hist-stat-lbl">HW Done</div></div>
    `;

    // All HW section (sorted by due date, done last)
    if(hwAll.length){
      const allHWEntry = document.createElement('div');
      allHWEntry.className = 'hist-entry';
      const sortedHW = [...hwAll].sort((a,b)=>{
        const ad=a.status==='done'?1:0, bd=b.status==='done'?1:0;
        if(ad!==bd) return ad-bd;
        if(a.due&&b.due) return a.due.localeCompare(b.due);
        return 0;
      });
      const hwItems = sortedHW.map(h=>{
        const isDone = h.status==='done';
        const priColor = h.pri==1?'var(--fire)':h.pri==2?'var(--gold)':'var(--neon)';
        const dueStr = h.due ? ` ¬∑ due ${new Date(h.due+'T12:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'})}` : '';
        return `<div class="hist-hw-item ${isDone?'done':''}">
          <span>${isDone?'‚úÖ':h.pri?`<span style="font-size:9px;font-weight:900;color:${priColor};border:1px solid ${priColor};border-radius:4px;padding:1px 4px">P${h.pri}</span>`:'üìå'}</span>
          <span class="hist-hw-name">${h.name||'Untitled'}</span>
          ${h.subject?`<span class="hist-hw-sub">${h.subject}${dueStr}</span>`:(dueStr?`<span class="hist-hw-sub">${dueStr.slice(3)}</span>`:'')}
        </div>`;
      }).join('');
      allHWEntry.innerHTML=`
        <div class="hist-date-row" style="margin-bottom:14px">
          <div class="hist-date">üìö All Homework</div>
          <div class="hist-b3-badge cyan">${totalHWDone} done</div>
        </div>
        <div class="hist-hw-block" style="margin-top:0">${hwItems}</div>
      `;
      list.appendChild(allHWEntry);
    }

    // Day entries
    dates.forEach(date=>{
      const b3 = load('big3_'+date, null);
      const d = new Date(date+'T12:00:00');
      const dayLabel = d.toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'});

      // HW added on this day
      const hwAdded = hwAll.filter(h=>h.added===date);
      // HW due on this day (but not already in hwAdded)
      const hwDue = hwAll.filter(h=>h.due===date && h.added!==date);

      // Skip day if no Big3 and no HW activity
      if(!b3 && hwAdded.length===0 && hwDue.length===0) return;

      const entry = document.createElement('div');
      entry.className = 'hist-entry';

      // Big 3 block
      let b3HTML = '';
      if(b3){
        const doneCount = b3.checks.filter(Boolean).length;
        const badgeCls = doneCount===3?'gold':doneCount>0?'cyan':'dim';
        const badgeTxt = doneCount===3?'‚úì All 3':doneCount+'/3';
        const items = b3.items.map((item,i)=>{
          if(!item) return '';
          const cls = b3.checks[i]?'done':'';
          const icon = b3.checks[i]?'‚úÖ':'‚¨ú';
          return `<div class="hist-b3-item ${cls}"><span class="hist-check">${icon}</span><span class="hist-b3-text">${item}</span></div>`;
        }).join('');
        b3HTML=`
          <div class="hist-date-row">
            <div class="hist-date">${dayLabel}</div>
            <div class="hist-b3-badge ${badgeCls}">${badgeTxt}</div>
          </div>
          ${items}`;
      } else {
        b3HTML=`<div class="hist-date-row"><div class="hist-date">${dayLabel}</div></div>`;
      }

      // HW added this day
      let hwAddedHTML = '';
      if(hwAdded.length){
        const items = hwAdded.map(h=>{
          const isDone = h.status==='done';
          const dueStr = h.due?` ¬∑ due ${new Date(h.due+'T12:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'})}` :'';
          return `<div class="hist-hw-item ${isDone?'done':''}">
            <span>${isDone?'‚úÖ':'‚ûï'}</span>
            <span class="hist-hw-name">${h.name||'Untitled'}</span>
            ${h.subject?`<span class="hist-hw-sub">${h.subject}${dueStr}</span>`:(dueStr?`<span class="hist-hw-sub">${dueStr.slice(3)}</span>`:'')}
          </div>`;
        }).join('');
        hwAddedHTML=`<div class="hist-hw-block"><div class="hist-hw-lbl">HW logged this day</div>${items}</div>`;
      }

      // HW due this day (not logged same day)
      let hwDueHTML = '';
      if(hwDue.length){
        const items = hwDue.map(h=>{
          const isDone = h.status==='done';
          return `<div class="hist-hw-item ${isDone?'done':''}">
            <span>${isDone?'‚úÖ':'üìÖ'}</span>
            <span class="hist-hw-name">${h.name||'Untitled'}</span>
            ${h.subject?`<span class="hist-hw-sub">${h.subject}</span>`:''}
          </div>`;
        }).join('');
        hwDueHTML=`<div class="hist-hw-block"><div class="hist-hw-lbl">HW due this day</div>${items}</div>`;
      }

      entry.innerHTML = b3HTML + hwAddedHTML + hwDueHTML;
      list.appendChild(entry);
    });
  }

  // Render whenever Log tab is opened
  $$('[data-page="history"]').forEach(btn=>btn.addEventListener('click',renderHistory));
})();
</script>
</body>
</html>
